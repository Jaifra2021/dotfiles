#!/usr/bin/env bash

fname=$1
shift 2>/dev/null
[[ -z "$fname" ]] && fname="$(date +'%Y_%m%d-%a-%H%M%S').bash"
path="$HOME/bin/$fname"
template="#!/usr/bin/env bash\n\ncat \$0\nexit 1\n# ---------- #\n\n"

if [[ ! -s "$path" ]]; then
    # Genarate the file since it does not exist
    echo -e "$template" > $path
    chmod +x $path

    # Open the file with vim (in insert mode, at the end of the file)
    vim + -c 'startinsert' $path
else
    # Open the file with vim wherever the cursor was before
    vim $path
fi

if [[ $(cat $path) == $(echo -e $template) ]]; then
    # User did not save any changes to the generated file, so delete it
    rm $path
else
    echo $path
fi

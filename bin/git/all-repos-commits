#!/usr/bin/env bash
#
# List recent commits. Any arguments are passed to the git log command

for repo in $(all-repos-list | tr '\n' '\0' | xargs -0); do
    branch=$(branchname $repo)
    cd $repo
    commits=$(git --no-pager log --pretty=format:'\n%C(yellow)%h %C(reset)%s %C(red)%ad %C(blue)%an%C(reset)' "$@" 2>/dev/null)
    if [[ -n "$commits" ]]; then
        numcommits=$(($(echo -e $commits | wc -l) -1))
        if [[ $numcommits -gt 5 ]]; then
            echo "$repo -- $numcommits commits (showing most recent 5)"
        else
            echo "$repo -- $numcommits commit(s)"
        fi
        echo -e "$branch"
        echo -e $commits | head -n 6
        echo -e "==============="
    fi
done
